<!-- JS Timer : Use JS to allow dynamic time logging (start/stop).
Task Logging : Create a TaskLog PHP class (task, duration, date). Save to and load logs
from a JSON file.
Display Hours : Display total hours per task using
AJAX. -->


<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Simple Timer</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4 bg-light">

<div class="container">
<h2>Task Timer</h2>

<input id="task" class="form-control mb-2" placeholder="Enter task">
<button class="btn btn-success me-2" onclick="startTimer()">Start</button>
<button class="btn btn-danger" onclick="stopTimer()">Stop</button>

<p>Time: <span id="time">00:00</span></p>

<h3>Logs</h3>
<button class="btn btn-secondary mb-2" onclick="loadLogs()">Refresh Logs</button>
<ul id="logs" class="list-group"></ul>
</div>

<script>
let start, interval;

function startTimer() {
  start = Date.now();
  interval = setInterval(() => {
    let sec = Math.floor((Date.now() - start)/1000);
    document.getElementById("time").innerText =
      String(Math.floor(sec/60)).padStart(2,'0') + ":" + String(sec%60).padStart(2,'0');
  }, 1000);
}

function stopTimer() {
  clearInterval(interval);
  let task = document.getElementById("task").value.trim();
  if(!task) return alert("Enter a task!");
  let sec = Math.floor((Date.now() - start)/1000);
  fetch("api.php?action=save", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({task, duration:sec})
  }).then(loadLogs);
}

function loadLogs() {
  fetch("api.php?action=load&_=" + Date.now())
    .then(r=>r.json())
    .then(data=>{
      let ul = document.getElementById("logs");
      ul.innerHTML = "";
      data.forEach(l=>{
        let li = document.createElement("li");
        li.className="list-group-item";
        li.innerText = `[${l.date}] ${l.task} - ${l.duration} sec`;
        ul.appendChild(li);
      });
    });
}

window.onload = loadLogs;
</script>

</body>
</html>
